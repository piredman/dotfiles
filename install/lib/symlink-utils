#!/usr/bin/env bash

create_symlink() {
    local source="$1"
    local target="$2"
    local backup_subdir="$3"

    if [ -L "$target" ] && [ "$(readlink "$target")" = "$source" ]; then
        print_success "$(basename "$target")"
        return 0
    fi

    local backup_path="$BACKUP_DIR"
    if [ -n "$backup_subdir" ]; then
        backup_path="$BACKUP_DIR/$backup_subdir"
    fi

    mkdir -p "$backup_path"

    if [ -e "$target" ]; then
        print_step "Backing up $(basename "$target")"
        mv "$target" "$backup_path/"
    fi

    mkdir -p "$(dirname "$target")"
    ln -s "$source" "$target"
    print_success "$(basename "$target")"
}